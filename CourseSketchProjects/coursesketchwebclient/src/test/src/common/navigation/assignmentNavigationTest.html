<html>
<head>
    <meta charset="utf-8">
    <title>Assignment Navigation methods test</title>
    <!-- test Library -->
    <link rel="import" href="/test/testUtilities/testUtilities.html">
        <link rel="import"
              href="/test/testUtilities/fakePage/fakePageInclude.html">
        <link rel="import"
              href="/test/testUtilities/fakePage/fakeTestData/fakeTestDataInclude.html">

    <!-- file being tested. -->
    <script src="/src/common/navigation/assignmentNavigation.js" data-cover></script>
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture"></div>


<script>
    CourseSketch.dataManager.getAssignment = function(assignmentID, callback) {
        if (assignmentID == "randomTest1234") {
            callback(CourseSketch.fakeAssignments[9]);
        } else if(assignmentID == "looping") {
            callback(CourseSketch.fakeAssignments[8]);
        } else {
            callback(CourseSketch.fakeAssignments[1]);
        }
    }
</script>
<script>
        QUnit.module("navigation index changing (problem style!)");
        test("randomAssignment", function(assert) {
            var testNavigator = new AssignmentNavigator("randomTest1234", 0, true);
            testNavigator.reloadAssignment();
            var index = testNavigator.getCurrentSubgroupIndex();
            testNavigator.gotoNext();
            assert.notEqual(undefined, testNavigator.getCurrentSubgroupIndex(), "testing randomness");
            var randomnessHappened = 0;
            var previousIndex = index;
            for (var k = 0; k < 100; k++) {
                // use goto next
                testNavigator.gotoNext();
                var newIndex = testNavigator.getCurrentSubgroupIndex();
                // ensures it is not staying at the same problem and not just going up by 1
                if (newIndex !== previousIndex + 1 && newIndex !== previousIndex) {
                    randomnessHappened++;
                }
                previousIndex = newIndex;
            }

            if (randomnessHappened > 50) {
                assert.ok(true, 'random happened sufficiently');
            } else {
                assert.ok(false, 'random only happened less than 50 times: ' + randomnessHappened);
            }
        });

        test("gradedAssignmentNavigationForward", function(assert) {
            var testNavigator = new AssignmentNavigator("graded", 0, true);
            testNavigator.reloadAssignment();
            var index = testNavigator.getCurrentSubgroupIndex();
            testNavigator.gotoNext();
            assert.equal(index + 1, testNavigator.getCurrentSubgroupIndex(), "testing that this assignment is in face correctly moving over");
        });

        test("gradedAssignmentNavigationPrevious", function(assert) {
            var testNavigator = new AssignmentNavigator("graded", 0, true);
            testNavigator.reloadAssignment();
            var index = testNavigator.getCurrentSubgroupIndex();
            testNavigator.gotoNext();
            assert.equal(index + 1, testNavigator.getCurrentSubgroupIndex(), "testing that this assignment is in face correctly moving over");

            testNavigator.gotoPrevious();
            assert.equal(index, testNavigator.getCurrentSubgroupIndex(), "testing that this assignment is in face correctly moving over");
        });

        test("goToProblem", function(assert) {
            var testNavigator = new AssignmentNavigator("graded", 0, true);
            testNavigator.reloadAssignment();
            var index = testNavigator.getCurrentSubgroupIndex();
            testNavigator.goToSubgroup(index + 1);
            assert.equal(index + 1, testNavigator.getCurrentSubgroupIndex(), "testing that this assignment is in face correctly moving over");
        });

        test("looping", function(assert) {
            var testNavigator = new AssignmentNavigator("looping", 0, true);
            testNavigator.reloadAssignment();
            var index = testNavigator.getCurrentSubgroupIndex();
            testNavigator.gotoNext();
            assert.equal(index + 1, testNavigator.getCurrentSubgroupIndex(), "testing that this assignment is in face correctly moving over");
            testNavigator.gotoNext();
            assert.equal(0, testNavigator.getCurrentSubgroupIndex(), "testing that this assignment is correctly resetting to zero");
            testNavigator.gotoPrevious();
            assert.equal(index + 1, testNavigator.getCurrentSubgroupIndex(), "testing that this assignment is correctly navigating back to the end");
        });
        QUnit.module("basic callbacks");
        QUnit.asyncTest("basic reload", function(assert) {
            expect(1);
            var testNavigator = new AssignmentNavigator("graded", 0, true);
            testNavigator.addCallback(function () {
                assert.ok(true);
                QUnit.start();
            });
            testNavigator.reloadAssignment();
        });
</script>
</body>
